#!/usr/bin/env zsh

fpath=(/usr/lib/zsh_libmisc/libmisc.zwc $fpath)
autoload libmiscinit
libmiscinit

input=$(fox-fr ./input)

polish_stone() {
  [ "$stone" = 0 ] && \
    print -n '1 ' && \
    return 0
  stoneln=$(getstrln "$stone")
  isevennum "$stoneln" && {
    haploid=$((stoneln/2))
    stoneleft=$((${stone: :$haploid}))
    stoneright=$((${stone:$haploid}))
    print -n ""$stoneleft" "$stoneright" "
    return 0
  }
  print -n ""$(($stone*2024))" " && \
    return 0
}

blinks=0
while true; do
  blinks=$((blinks+1))
  placeholder=""
  IFS=$' '
  for stone in $=input; do
    placeholder=""$placeholder""$(polish_stone)""
  done
  unset IFS
  DEBUG=1 && print "DEBUG: blink "$blinks""
  input=$placeholder
  print "$input"
  [ "$blinks" = 25 ] && \
    break
  DEBUG=1 && {
    stone_count=0
    IFS=$' '
    for stones in $=input; do
      stone_count=$((stone_count+1))
    done
    unset IFS

    print "Stone count:"$stone_count""
  }
done

stone_count=0
IFS=$' '
for stones in $=input; do
  stone_count=$((stone_count+1))
done
unset IFS

print "Stone count:"$stone_count""
